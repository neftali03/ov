const sidebar=document.body.querySelector("#sidebar");function updateShowSidebar(){let isSidebarSet=localStorage.getItem("showSidebar")!==null;let showSidebar=localStorage.getItem("showSidebar")==="true";if(!isSidebarSet){sidebar.classList.add("show")}else if(showSidebar){sidebar.classList.add("show")}else{sidebar.classList.remove("show")}}updateShowSidebar();sidebar.addEventListener("hide.bs.collapse",e=>{if(e.target.id==="sidebar"){localStorage.setItem("showSidebar",false);updateShowSidebar()}});sidebar.addEventListener("show.bs.collapse",e=>{if(e.target.id==="sidebar"){localStorage.setItem("showSidebar",true);updateShowSidebar()}});document.addEventListener("keydown",function(event){let key=event.key|event.keyCode;if(key===113){const sidebar=document.querySelector("#sidebar");const collapseSidebar=new bootstrap.Collapse(sidebar);collapseSidebar.toggle()}});const toastElements=document.querySelectorAll(".toast:not(#base-message):not(#request-message)");const toasts=[...toastElements].map(toastEl=>new bootstrap.Toast(toastEl));toasts.map(toastEl=>toastEl.show());function showMessage(content,level,_autohide=true){const messages=document.body.querySelector("#messages");const message=messages.firstElementChild.cloneNode(true);const messageToast=new bootstrap.Toast(message,{autohide:_autohide});messages.appendChild(message);message.querySelector("#message-body").innerHTML=content;if(level===20){message.classList.add("bg-info","text-bg-info")}else if(level===25){message.classList.add("bg-success","text-bg-success")}else if(level===30){message.classList.add("bg-warning","text-bg-warning")}else if(level===40){message.classList.add("bg-danger","text-bg-danger")}toasts.push(messageToast);messageToast.show()}document.body.addEventListener("showHtmxMessage",evt=>{showMessage(evt.detail.content,evt.detail.level)});document.body.addEventListener("htmx:beforeSwap",evt=>{if(evt.detail.xhr.status===422){evt.detail.shouldSwap=true;evt.detail.isError=false}else{if(evt.detail.xhr.status>=400&&evt.detail.xhr.status<600){showMessage("Ha ocurrido un error inesperado, por favor contacte al administrador",40,false)}}});document.body.addEventListener("htmx:sendError",()=>{let message="";message+="Ha ocurrido un error de conexión, ";message+="por favor intente nuevamente o contacte al administrador";showMessage(message,40,false);document.body.querySelector("#request-message").classList.remove("show")});document.body.querySelectorAll("[dx-case]").forEach(input=>{input.addEventListener("input",function(event){let toCase=input.getAttribute("dx-case");if(toCase==="lower"){event.target.value=event.target.value.toLowerCase()}else if(toCase==="upper"){event.target.value=event.target.value.toUpperCase()}})});document.body.querySelectorAll("[dx-numeric]").forEach(input=>{input.addEventListener("input",function(event){event.target.value=event.target.value.replace(/\D/g,"")})});document.body.querySelectorAll("[dx-alphanumeric]").forEach(input=>{input.addEventListener("input",function(event){event.target.value=event.target.value.replace(/[^a-zA-Z0-9Ññ]/g,"")})});document.querySelectorAll("[data-copy-content]").forEach(item=>{item.addEventListener("click",function(){navigator.clipboard.writeText(item.dataset.copyContent||"").then(()=>{showMessage(item.dataset.copyMessage||"Contenido copiado al portapapeles",item.dataset.copyMessageLevel||25)},()=>{showMessage("El contenido no pudo ser copiado, contacte al administrador",30)})})});document.body.querySelectorAll("#form_modal").forEach(item=>{item.addEventListener("closeModalForm",()=>{let modal=bootstrap.Modal.getInstance(item);modal.hide()})});document.querySelectorAll('[data-bs-toggle="modal"]').forEach(item=>{item.addEventListener("click",function(){setTimeout(()=>{const modal=document.querySelector(item.getAttribute("data-bs-target"));const canvas=modal.querySelector("#signature-pad");if(!canvas)return;const ctx=canvas.getContext("2d");const clearButton=modal.querySelector("#clear-signature");const signatureInput=modal.querySelector("#id_signature");let isDrawing=false;canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;ctx.lineWidth=2;ctx.lineCap="round";ctx.strokeStyle="#000";function getPos(e){const rect=canvas.getBoundingClientRect();return{x:(e.clientX||e.touches[0].clientX)-rect.left,y:(e.clientY||e.touches[0].clientY)-rect.top}}function startDrawing(e){e.preventDefault();isDrawing=true;const pos=getPos(e);ctx.beginPath();ctx.moveTo(pos.x,pos.y)}function draw(e){if(!isDrawing)return;e.preventDefault();const pos=getPos(e);ctx.lineTo(pos.x,pos.y);ctx.stroke()}function stopDrawing(){if(!isDrawing)return;isDrawing=false;ctx.closePath();signatureInput.value=canvas.toDataURL()}canvas.addEventListener("touchstart",startDrawing);canvas.addEventListener("touchmove",draw);canvas.addEventListener("touchend",stopDrawing);canvas.addEventListener("mousedown",startDrawing);canvas.addEventListener("mousemove",draw);canvas.addEventListener("mouseup",stopDrawing);canvas.addEventListener("mouseleave",stopDrawing);if(clearButton){clearButton.addEventListener("click",()=>{ctx.clearRect(0,0,canvas.width,canvas.height);ctx.beginPath();signatureInput.value=""})}},500)})});let colorModeToggler=document.querySelector("#toggle-color-mode");if(localStorage.getItem("colorTheme")==="dark"){document.documentElement.setAttribute("data-bs-theme","dark");colorModeToggler.innerHTML='<i class="bi bi-moon-fill"></i>'}else{document.documentElement.setAttribute("data-bs-theme","light");colorModeToggler.innerHTML='<i class="bi bi-brightness-high-fill"></i>'}colorModeToggler.addEventListener("click",function(){if(document.documentElement.getAttribute("data-bs-theme")==="dark"){document.documentElement.setAttribute("data-bs-theme","light");colorModeToggler.innerHTML='<i class="bi bi-brightness-high-fill"></i>';localStorage.setItem("colorTheme","light")}else{document.documentElement.setAttribute("data-bs-theme","dark");colorModeToggler.innerHTML='<i class="bi bi-moon-fill"></i>';localStorage.setItem("colorTheme","dark")}});